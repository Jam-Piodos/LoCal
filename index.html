<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0">
  <title>Lot 185 - UTM to GPS</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    #map {
      width: 100%;
      height: 85vh;
    }
    .form-container {
      padding: 10px;
      background: #f8f9fa;
      border-bottom: 1px solid #ccc;
    }
    input, button {
      margin: 5px;
      padding: 6px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <!-- Input BLMM1 true UTM coords -->
  <div class="form-container">
    <label>BLMM1 UTM Easting:</label>
    <input type="number" id="blmmE" value="500000"> <!-- Replace with actual value -->

    <label>BLMM1 UTM Northing:</label>
    <input type="number" id="blmmN" value="930000"> <!-- Replace with actual value -->

    <label>Zone:</label>
    <input type="number" id="zone" value="51">

    <label>Hemisphere:</label>
    <select id="hemisphere">
      <option value="N" selected>Northern</option>
      <option value="S">Southern</option>
    </select>

    <button onclick="plotLot()">Plot Lot 185</button>
  </div>

  <div id="map"></div>

  <script>
    // Create map centered on Manolo Fortich
    var map = L.map('map').setView([8.37, 124.86], 13);

    // Satellite tiles
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles © Esri, Maxar, Earthstar Geographics, and the GIS User Community'
    }).addTo(map);

    var lotLayer;

    // Local coordinates from survey (Technical Description)
    const localPoints = [
      [23425.420, 23198.620], // P1 (N, E)
      [23354.420, 23189.620], // P2
      [23311.940, 23159.570], // P3
      [23304.490, 23301.590]  // P4
    ];

    function plotLot() {
      const blmmE = parseFloat(document.getElementById('blmmE').value);
      const blmmN = parseFloat(document.getElementById('blmmN').value);
      const zone = parseInt(document.getElementById('zone').value);
      const hemisphere = document.getElementById('hemisphere').value;

      if (isNaN(blmmE) || isNaN(blmmN)) {
        alert("Please input BLMM1 UTM coordinates!");
        return;
      }

      // Projection string
      let utmProj = `+proj=utm +zone=${zone} +datum=WGS84`;
      if (hemisphere === 'S') utmProj += " +south";

      // Clear old lot
      if (lotLayer) {
        map.removeLayer(lotLayer);
      }

      lotLayer = L.layerGroup().addTo(map);

      let latlngs = [];

      localPoints.forEach(([northing, easting], idx) => {
        // Apply translation from local → UTM
        let E_utm = blmmE + (easting - 20000);
        let N_utm = blmmN + (northing - 20000);

        // Convert UTM → WGS84
        const [lon, lat] = proj4(utmProj, 'WGS84', [E_utm, N_utm]);

        latlngs.push([lat, lon]);

        // Mark each corner
        L.circleMarker([lat, lon], {
          radius: 6,
          color: "red",
          fillColor: "red",
          fillOpacity: 0.9
        }).bindPopup(`P${idx+1}<br>Lat: ${lat.toFixed(6)}, Lon: ${lon.toFixed(6)}`)
          .addTo(lotLayer);
      });

      // Close polygon
      latlngs.push(latlngs[0]);

      // Draw polygon
      L.polygon(latlngs, {
        color: "yellow",
        weight: 2,
        fillColor: "orange",
        fillOpacity: 0.3
      }).addTo(lotLayer);

      // Fit map to polygon
      map.fitBounds(latlngs);
    }
  </script>
</body>
</html>
