<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0">
  <title>Project Kalasan - Manolo Fortich Mapper</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #map { height: 500px; }
    .form-container {
      background: #fff; padding: 15px; margin: 10px auto;
      width: 300px; border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
      text-align: center;
    }
    input { margin: 5px; width: 100%; padding: 6px; }
    button { padding: 6px 12px; margin-top: 8px; }
  </style>
</head>
<body>

<div class="form-container">
  <h3>Local Survey Grid → GPS (Scaled to Manolo Fortich)</h3>
  <label>Easting (m):</label>
  <input type="number" id="easting" value="23198.62">
  <label>Northing (m):</label>
  <input type="number" id="northing" value="23425.24">
  <button onclick="convert()">Convert</button>
  <p id="result"></p>
</div>

<div id="map"></div>

<script>
  // --- Define Manolo Fortich GPS bounds (approx) ---
  const manoloBounds = {
    minLat: 8.35,
    maxLat: 8.55,
    minLng: 124.75,
    maxLng: 125.05
  };

  // --- Define local survey grid bounds (from technical desc values) ---
  const localBounds = {
    minE: 20000, maxE: 24000,
    minN: 23000, maxN: 24000
  };

  // --- Init map with satellite view ---
  var map = L.map('map').setView([8.45, 124.9], 13);

  L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles © Esri, Maxar, Earthstar Geographics'
  }).addTo(map);

  var marker;

  function scaleToManolo(easting, northing) {
    // Normalize 0-1 in local grid
    let normE = (easting - localBounds.minE) / (localBounds.maxE - localBounds.minE);
    let normN = (northing - localBounds.minN) / (localBounds.maxN - localBounds.minN);

    // Scale into Manolo GPS bounds
    let lat = manoloBounds.minLat + normN * (manoloBounds.maxLat - manoloBounds.minLat);
    let lng = manoloBounds.minLng + normE * (manoloBounds.maxLng - manoloBounds.minLng);

    return [lat, lng];
  }

  function convert() {
    let e = parseFloat(document.getElementById("easting").value);
    let n = parseFloat(document.getElementById("northing").value);

    if (isNaN(e) || isNaN(n)) {
      alert("Please enter valid numbers");
      return;
    }

    let [lat, lng] = scaleToManolo(e, n);

    document.getElementById("result").innerText =
      `Latitude: ${lat.toFixed(6)}, Longitude: ${lng.toFixed(6)}`;

    // Remove old marker if exists
    if (marker) map.removeLayer(marker);

    // Add circle marker
    marker = L.circleMarker([lat, lng], {
      color: "red",
      radius: 8,
      fillColor: "#f03",
      fillOpacity: 0.7
    }).addTo(map).bindPopup(`E:${e}, N:${n}<br>Lat:${lat.toFixed(6)}, Lng:${lng.toFixed(6)}`).openPopup();

    map.setView([lat, lng], 15);
  }

  // Run initial conversion
  convert();
</script>
</body>
</html>
