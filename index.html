<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="initial-scale=1.0"/>
  <title>Land Survey - Bearings Only</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body { margin:0; font-family: Arial, sans-serif; display:flex; flex-direction:column; height:100vh; }
    #map { width:100%; flex:1; min-height:400px; }
    .panel { padding:15px; background:#f7f9fb; border-top:2px solid #ddd; max-height:45vh; overflow-y:auto; }
    .input-group { margin-bottom:10px; display:flex; align-items:center; }
    .input-group label { width:120px; font-weight:bold; font-size:13px; }
    .bearing-input { display:flex; gap:8px; align-items:center; }
    .bearing-input input { max-width:80px; }
    .bearing-input select { width:90px; font-weight:bold; }
    button { background:#4CAF50; color:white; border:none; padding:8px 14px; border-radius:4px; margin-top:5px; cursor:pointer; }
    button:hover { background:#45a049; }
    .btn-secondary { background:#2196F3; } .btn-secondary:hover { background:#0b7dda; }
    .btn-danger { background:#f44336; } .btn-danger:hover { background:#da190b; }
    .points-list { background:white; border:1px solid #ddd; border-radius:4px; padding:10px; }
    .point-item { padding:6px; border-bottom:1px solid #eee; font-size:13px; display:flex; justify-content:space-between; }
    .point-item:last-child { border-bottom:none; }
    h3 { margin:8px 0; }
  </style>
</head>
<body>

<div id="map"></div>

<div class="panel">
  <div class="input-section">
    <h3>‚ûï Add Bearing</h3>
    <div class="input-group">
      <label>Line Name:</label>
      <input id="lineName" value="1-2">
    </div>
    <div class="input-group">
      <label>Bearing:</label>
      <div class="bearing-input">
        <select id="dirNS">
          <option value="N">N</option>
          <option value="S">S</option>
        </select>
        <input id="degrees" type="number" min="0" max="90" placeholder="Deg">
        <span>¬∞</span>
        <input id="minutes" type="number" min="0" max="59" placeholder="Min">
        <span>'</span>
        <select id="dirEW">
          <option value="E">E</option>
          <option value="W">W</option>
        </select>
      </div>
    </div>
    <button onclick="addBearing()">‚ûï Add Bearing</button>
    <button class="btn-secondary" onclick="exportData()">üì§ Export</button>
    <button class="btn-danger" onclick="clearAll()">üóëÔ∏è Clear</button>
  </div>

  <h3>üìã Bearings (<span id="bearingCount">0</span>)</h3>
  <div class="points-list" id="bearingsList">
    <div>No bearings added yet.</div>
  </div>
</div>

<script>
let bearings = [];
let basePoint = { lat: 8.398673, lon: 124.894305 }; // fixed reference point
const map = L.map('map').setView([basePoint.lat, basePoint.lon], 17);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(map);
let layerGroup = L.layerGroup().addTo(map);

function addBearing() {
  const lineName = document.getElementById('lineName').value.trim();
  const deg = parseFloat(document.getElementById('degrees').value);
  const min = parseFloat(document.getElementById('minutes').value) || 0;
  const ns = document.getElementById('dirNS').value;
  const ew = document.getElementById('dirEW').value;

  if (isNaN(deg)) { alert("Enter degrees"); return; }

  let angle = deg + min/60;
  let azimuth;
  if (ns==="N" && ew==="E") azimuth = angle;
  if (ns==="S" && ew==="E") azimuth = 180 - angle;
  if (ns==="S" && ew==="W") azimuth = 180 + angle;
  if (ns==="N" && ew==="W") azimuth = 360 - angle;

  bearings.push({ lineName, bearingStr:`${ns}${deg}¬∞${min}'${ew}`, azimuth });
  updateList();
}

function updateList() {
  document.getElementById("bearingCount").innerText = bearings.length;
  const list = document.getElementById("bearingsList");
  if (bearings.length===0) { list.innerHTML = "<div>No bearings added yet.</div>"; return; }
  list.innerHTML = bearings.map((b,i)=>`
    <div class="point-item">
      <span>${b.lineName}</span>
      <span>${b.bearingStr} (${b.azimuth.toFixed(2)}¬∞)</span>
    </div>
  `).join("");
}

function clearAll() {
  bearings=[]; updateList();
}

function exportData() {
  if (bearings.length===0) { alert("No data to export"); return; }
  let txt = `Base Point: ${basePoint.lat}, ${basePoint.lon}\nBearings:\n`;
  bearings.forEach(b => {
    txt += `${b.lineName}\t${b.bearingStr}\t${b.azimuth.toFixed(2)}¬∞\n`;
  });
  alert(txt);
}
</script>
</body>
</html>
